<ContentDialog
    x:Class="EducationInstitutionsRB.Views.InstitutionDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:EducationInstitutionsRB.Converters"
    Title="{x:Bind Title}"
    PrimaryButtonText="Сохранить"
    CloseButtonText="Отмена"
    PrimaryButtonClick="ContentDialog_PrimaryButtonClick"
    DefaultButton="Primary"
    mc:Ignorable="d">

    <ContentDialog.Resources>
        <converters:DateTimeToDateTimeOffsetConverter x:Key="DateTimeToDateTimeOffsetConverter"/>
    </ContentDialog.Resources>

    <ScrollViewer MaxHeight="500" VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="16" Padding="0,0,8,0">
            <TextBlock Text="Поля, отмеченные *, обязательны для заполнения" 
                       FontStyle="Italic" Foreground="Gray" FontSize="12"/>

            <!-- Основная информация -->
            <TextBox Header="Название *" 
                     Text="{x:Bind Institution.Name, Mode=TwoWay}"
                     PlaceholderText="Введите название учреждения"
                     HorizontalAlignment="Stretch"/>

            <ComboBox Header="Тип *" 
                      ItemsSource="{x:Bind InstitutionTypes}" 
                      SelectedItem="{x:Bind Institution.Type, Mode=TwoWay}"
                      PlaceholderText="Выберите тип учреждения"
                      HorizontalAlignment="Stretch"/>

            <TextBox Header="Адрес *" 
                     Text="{x:Bind Institution.Address, Mode=TwoWay}"
                     PlaceholderText="Введите адрес учреждения"
                     HorizontalAlignment="Stretch"/>

            <TextBox Header="Контакты" 
                     Text="{x:Bind Institution.Contacts, Mode=TwoWay}"
                     PlaceholderText="Введите контактную информацию"
                     HorizontalAlignment="Stretch"/>

            <!-- Регион и район с автодополнением -->
            <ComboBox Header="Область *" 
                      x:Name="RegionCombo"
                      DisplayMemberPath="Name"
                      SelectedValuePath="Id"
                      SelectionChanged="RegionCombo_SelectionChanged"
                      PlaceholderText="Выберите область"
                      HorizontalAlignment="Stretch"/>

            <AutoSuggestBox Header="Район *" 
                            x:Name="DistrictSuggestBox"
                            PlaceholderText="Начните вводить название района"
                            Text="{x:Bind DistrictSearchText, Mode=TwoWay}"
                            QueryIcon="Find"
                            TextChanged="DistrictSuggestBox_TextChanged"
                            SuggestionChosen="DistrictSuggestBox_SuggestionChosen"
                            QuerySubmitted="DistrictSuggestBox_QuerySubmitted"
                            HorizontalAlignment="Stretch">
                <AutoSuggestBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Padding="8">
                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding Region.Name}" FontSize="12" Foreground="Gray"/>
                        </StackPanel>
                    </DataTemplate>
                </AutoSuggestBox.ItemTemplate>
            </AutoSuggestBox>

            <!-- Статистика -->
            <TextBlock Text="Статистика" FontWeight="SemiBold" FontSize="14"/>

            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <TextBox Grid.Column="0" 
                         Header="Количество учащихся" 
                         Text="{x:Bind Institution.StudentCount, Mode=TwoWay}"
                         PlaceholderText="0"
                         HorizontalAlignment="Stretch"/>
                <TextBox Grid.Column="1" 
                         Header="Количество персонала" 
                         Text="{x:Bind Institution.StaffCount, Mode=TwoWay}"
                         PlaceholderText="0"
                         HorizontalAlignment="Stretch"/>
            </Grid>

            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <TextBox Grid.Column="0" 
                         Header="Принято учащихся" 
                         Text="{x:Bind Institution.AdmittedCount, Mode=TwoWay}"
                         PlaceholderText="0"
                         HorizontalAlignment="Stretch"/>
                <TextBox Grid.Column="1" 
                         Header="Отчислено учащихся" 
                         Text="{x:Bind Institution.ExpelledCount, Mode=TwoWay}"
                         PlaceholderText="0"
                         HorizontalAlignment="Stretch"/>
            </Grid>

            <!-- Статус и дата -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <ComboBox Grid.Column="0" 
                          Header="Статус" 
                          ItemsSource="{x:Bind StatusTypes}" 
                          SelectedItem="{x:Bind Institution.Status, Mode=TwoWay}"
                          HorizontalAlignment="Stretch"/>

                <DatePicker Grid.Column="1" 
                            Header="Дата регистрации" 
                            Date="{x:Bind Institution.RegistrationDate, Mode=TwoWay, Converter={StaticResource DateTimeToDateTimeOffsetConverter}}"
                            HorizontalAlignment="Stretch"/>
            </Grid>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>